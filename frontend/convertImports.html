<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
	      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Convert Imports</title>
	<style>
		textarea {
			height: 90vh;
			width: 48vw;
		}
	</style>
</head>
<body>
<textarea id="input"></textarea>
<textarea id="output"></textarea>
<div>
	<input type="checkbox" id="subdirectory"/>
	<label for="subdirectory">Is in sub directory?</label>
	<button id="convert">Convert</button>
</div>
<script>
	document.getElementById('convert').addEventListener('click', function () {
		let input = document.getElementById('input').value;
		let match = input.match(/(?:define|require)\(\[([^\]]*)],\s*function ?\(([^\)]*)\)/);
		if (!match) {
			alert('Input didn\'t match :(');
		} else {
			function split(input) {
				return input.split(',').map(part => part.trim());
			}

			let paths = split(match[1]);
			let modules = split(match[2]);

			let imports = [];

			let isSubdirectory = document.getElementById('subdirectory').checked;

			for (let i = 0; i < paths.length; i++) {
				if (!paths[i]) {
					continue;
				}

				// Handle common special cases
				switch (modules[i]) {
					case 'Constants':
						imports.push('import {BasicConfig as Constants} from \'' +
							(isSubdirectory ? '../' : '') +
							'../config/Basic\';\n');
						continue;
					case 'GraphicsConfig':
						imports.push('import {GraphicsConfig} from \'' +
							(isSubdirectory ? '../' : '') +
							'../config/Graphics\';\n');
						continue;
					case 'Utils':
						imports.push('import {} from \'' +
							(isSubdirectory ? '.' : '') +
							'./Utils\';\n');
						continue;
					case 'GameObject':
						imports.push('import GameObject from \'' +
							(isSubdirectory ? '.' : '') +
							'./gameObjects/_GameObject\';\n');
						continue;
					case 'Develop':
						imports.push('import * as Develop from \'' +
							(isSubdirectory ? '.' : '') +
							'./develop/_Develop\';\n');
						continue;
					case 'MapEditor':
						imports.push('import * as MapEditor from \'' +
							(isSubdirectory ? '.' : '') +
							'./mapEditor/_MapEditor\';\n');
						continue;
					case 'PIXI':
						imports.push('import * as PIXI from \'pixi.js\';\n');
						continue;
					case '_':
						imports.push('import * as _ from \'lodash\';\n');
						continue;
					case 'ItemType':
						imports.push('import {' + modules[i] +
							'} from \'' +
							(isSubdirectory ? '.' : '') +
							'./items/' + modules[i] +
							'\';\n');
						continue;
				}

				var defaultClasses = [
					'GameMapWithBackend',
					'DebugCircle',
					'Resource',
					'Vector',
					'ClientMessage',
					'GameState',
					'ScoreboardMessage',
					'Welcome',
					'Character',
					'InjectedSVG',
					'Mob',
					'Placeable',
					'Items',
					'Camera'
				];

				imports.push('import ');
				if (modules[i]) {
					if (defaultClasses.indexOf(modules[i]) === -1) {
						imports.push('* as ');
					}
					imports.push(modules[i]);
				} else {
					imports.push('?');
				}
				imports.push(' from ');
				if (isSubdirectory) {
					imports.push(paths[i].replace("'", "'../"));
				} else {
					imports.push(paths[i].replace("'", "'./"));
				}
				imports.push(';');
				imports.push('\n');
			}

			document.getElementById('output').value = imports.join('');
		}
	})
</script>
</body>
</html>